<div class="container-fluid p-3">
  <dx-load-panel
    [visible]="isLoading"
    [showIndicator]="true"
    [showPane]="true"
    [shading]="true"
    [hideOnOutsideClick]="false"
  ></dx-load-panel>

  <!-- Thông tin chung -->
  <div class="mb-4">
    <div class="row">
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Loại câu hỏi <span class="text-danger">*</span></label>
        <dx-select-box
          [(value)]="editingQuestion.Question_Type"
          [items]="[
            { value: questionTypes.MULTIPLE_CHOICE, text: 'Trắc nghiệm' },
            { value: questionTypes.TRUE_FALSE, text: 'Đúng/Sai' },
            { value: questionTypes.FILL_IN_THE_BLANK, text: 'Điền vào chỗ trống' }
          ]"
          displayExpr="text"
          valueExpr="value"
          (onValueChanged)="onQuestionTypeChanged($event)"
          [stylingMode]="'filled'"
        ></dx-select-box>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Chủ đề <span class="text-danger">*</span></label>
        <dx-select-box
          [(value)]="editingQuestion.Topic_Id"
          [items]="topics"
          displayExpr="Name"
          valueExpr="Id"
          [stylingMode]="'filled'"
          [searchEnabled]="true"
          placeholder="Chọn chủ đề"
        >
          <dx-validator>
            <dxi-validation-rule type="required" message="Vui lòng chọn chủ đề"></dxi-validation-rule>
          </dx-validator>
        </dx-select-box>
      </div>
      <div class="col-md-6 mb-3">
        <label class="form-label fw-bold">Độ khó <span class="text-danger">*</span></label>
        <dx-select-box
          [(value)]="editingQuestion.Difficulty_Level"
          [items]="difficultyLevels"
          displayExpr="text"
          valueExpr="value"
          [stylingMode]="'filled'"
        >
          <dx-validator>
            <dxi-validation-rule type="required" message="Vui lòng chọn độ khó"></dxi-validation-rule>
          </dx-validator>
        </dx-select-box>
      </div>
      <div class="col-12 mb-3">
        <label class="form-label fw-bold">Nội dung câu hỏi <span class="text-danger">*</span></label>
        <app-custom-ckeditor
          [(Content)]="editingQuestion.Content"
          [placeholder]="'Nhập nội dung câu hỏi'"
          [isValidate]="true"
          [message]="'Nội dung câu hỏi là bắt buộc'"
        ></app-custom-ckeditor>
      </div>
    </div>
  </div>

  <!-- Form câu hỏi trắc nghiệm -->
  <div class="question-options mb-4" *ngIf="Number(editingQuestion.Question_Type) === questionTypes.MULTIPLE_CHOICE">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="fw-bold mb-0">Các lựa chọn</h5>
      <dx-button
        hint="Thêm lựa chọn"
        [icon]="dxButtonConfig.add_icon"
        [type]="dxButtonConfig.add_type"
        (onClick)="addOption()"
        [text]="'Thêm lựa chọn'"
        [stylingMode]="'contained'"
      ></dx-button>
    </div>

    <div class="option-list">
      <div class="option-item p-3 mb-2 border rounded" *ngFor="let option of multipleChoiceData.options; let i = index" [ngClass]="{'correct-answer': multipleChoiceData.correctOption === i}">
        <div class="d-flex align-items-center">
          <div class="option-radio me-3">
            <input
              class="form-check-input"
              type="radio"
              name="correctOption"
              [id]="'option' + i"
              [checked]="multipleChoiceData.correctOption === i"
              (change)="multipleChoiceData.correctOption = i"
            >
            <span class="correct-answer-label" *ngIf="multipleChoiceData.correctOption === i">Đáp án đúng</span>
          </div>
          <div class="option-content flex-grow-1">
            <dx-text-box
              [(value)]="multipleChoiceData.options[i]"
              [placeholder]="'Lựa chọn ' + (i + 1)"
              [stylingMode]="'filled'"
            ></dx-text-box>
          </div>
          <div class="option-actions ms-2">
            <dx-button
              [icon]="dxButtonConfig.delete_icon"
              [type]="dxButtonConfig.delete_type"
              (onClick)="removeOption(i)"
              [disabled]="multipleChoiceData.options.length <= 2"
              [stylingMode]="'contained'"
            ></dx-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Form câu hỏi đúng/sai -->
  <div class="true-false-options mb-4" *ngIf="Number(editingQuestion.Question_Type) === questionTypes.TRUE_FALSE">
    <h5 class="fw-bold mb-3">Đáp án đúng</h5>
    <div class="d-flex">
      <div class="form-check form-check-inline me-4">
        <input
          class="form-check-input"
          type="radio"
          id="answerTrue"
          name="trueFalseAnswer"
          [checked]="trueFalseData.correctAnswer"
          (change)="trueFalseData.correctAnswer = true"
        >
        <label class="form-check-label" for="answerTrue">Đúng</label>
        <span class="correct-answer-label ms-2" *ngIf="trueFalseData.correctAnswer">Đáp án đúng</span>
      </div>
      <div class="form-check form-check-inline">
        <input
          class="form-check-input"
          type="radio"
          id="answerFalse"
          name="trueFalseAnswer"
          [checked]="!trueFalseData.correctAnswer"
          (change)="trueFalseData.correctAnswer = false"
        >
        <label class="form-check-label" for="answerFalse">Sai</label>
        <span class="correct-answer-label ms-2" *ngIf="!trueFalseData.correctAnswer">Đáp án đúng</span>
      </div>
    </div>
  </div>

  <!-- Form câu hỏi điền vào chỗ trống -->
  <div class="fill-blank-options mb-4" *ngIf="Number(editingQuestion.Question_Type) === questionTypes.FILL_IN_THE_BLANK">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="fw-bold mb-0">Các đáp án đúng</h5>
      <dx-button
        hint="Thêm đáp án"
        [icon]="dxButtonConfig.add_icon"
        [type]="dxButtonConfig.add_type"
        (onClick)="addAnswer()"
        [text]="'Thêm đáp án'"
        [stylingMode]="'contained'"
      ></dx-button>
    </div>

    <div class="answer-list">
      <div class="answer-item p-3 mb-2 border rounded" *ngFor="let answer of fillInTheBlankData.correctAnswers; let i = index">
        <div class="d-flex align-items-center">
          <div class="answer-label me-3">
            <span class="correct-answer-label">Đáp án đúng {{i + 1}}</span>
          </div>
          <div class="answer-content flex-grow-1">
            <dx-text-box
              [(value)]="fillInTheBlankData.correctAnswers[i]"
              [placeholder]="'Đáp án ' + (i + 1)"
              [stylingMode]="'filled'"
            ></dx-text-box>
          </div>
          <div class="answer-actions ms-2">
            <dx-button
              [icon]="dxButtonConfig.delete_icon"
              [type]="dxButtonConfig.delete_type"
              (onClick)="removeAnswer(i)"
              [disabled]="fillInTheBlankData.correctAnswers.length <= 1"
              [stylingMode]="'contained'"
            ></dx-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Giải thích -->
  <div class="mb-4">
    <label class="form-label fw-bold">Giải thích</label>
    <app-custom-ckeditor
      [(Content)]="editingQuestion.Explanation"
      [placeholder]="'Nhập giải thích cho câu hỏi'"
    ></app-custom-ckeditor>
  </div>

  <!-- Nút tác vụ -->
  <div class="d-flex justify-content-end mt-4">
    <dx-button
      text="Hủy"
      [type]="dxButtonConfig.default_type"
      (onClick)="cancelQuestion()"
      class="me-2"
      [stylingMode]="'outlined'"
    ></dx-button>
    <dx-button
      text="Lưu"
      [icon]="dxButtonConfig.save_icon"
      [type]="dxButtonConfig.save_type"
      (onClick)="saveQuestion()"
      [stylingMode]="'contained'"
    ></dx-button>
  </div>
</div>
